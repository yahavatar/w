<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
	    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <link rel="icon" href="http://pododd.com/w/weather.png" type="image/x-icon">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>Weather</title>
	    <style>
	        body{
	            background-color: black;
	            color: white;
	            font-family: arial;
	            font-size:25px;
	            width: 99%;
    	        }
            #div_maps img{
				width: 100%;
			    }
			#div_maps table{

				width: 100%;
			    }
			#div_maps td{
				text-align: center;
				width: 50%;
			    }
			.header{
			    font-size: 15px !important;
			    }
	        .icn{
	            width: 50px;
	            }
	        .icn_wind{
	            width: 15px;
	            }
	        .rec{
	            font-size: 15px;
	            }
	        .row_title{
	            font-size: 15px;
	            }
	        .tbl{
	            padding: 5px;
	            width: 100%;
	            }
	        .tbl td{
	            border-bottom: 1px solid black;
	            border-left: 1px solid black;
	            text-align: center;
	            valign: center;
	            }
	            
	        .tbl_last5 td{
	            font-size: 15px;
	            }
	        .temp_above_avg{
	            background-color: red;
	            border-radius: 5px;
	            color white;
	            margin 5px;
	            padding 5px;
	            }
	        .temp_at_avg{
	            }
	        .temp_below_avg{
	            background-color: darkblue;
	            color: white
	            }
	        .wind{
	            font-size: 10px;
	            }
	        .year{
	            font-size: 12px;
	            }
	        .yr_new{
	            /*background-color: #cd6155;*/
	            background-color: yellow;
	            border-radius: 5px;
	            color: black;
	            }
	    </style>
	</head>

	<body>
		<center>
		    <div id="div_main">
            <div id="div_daily_table">
		    </div>
            <p></p>
        </div>
        <div id="div_maps">
            <table width="100%" cellspacing="1" cellpadding="0" border="0">
            <tbody><tr>
              <!--<td width="50%"><img src="https://radblast-aws.wunderground.com/cgi-bin/radar/WUNIDS_map?station=IND&amp;brand=wui&amp;num=10&amp;delay=15&amp;type=N0R&amp;frame=0&amp;scale=1.000&amp;noclutter=0&amp;t=1368730983&amp;lat=0&amp;lon=0&amp;label=you&amp;showstorms=0&amp;map.x=400&amp;map.y=240&amp;centerx=400&amp;centery=240&amp;transx=0&amp;transy=0&amp;showlabels=1&amp;severe=0&amp;rainsnow=0&amp;lightning=0&amp;smooth=0" alt="map"></td>-->
              <!--<td width="50%"><img src="https://media.psg.nexstardigital.net/wavy/weather/_National_satrad.gif?w=876"></td>-->
              <td width="50%"><img src="https://radar.weather.gov/ridge/standard/CENTGRLAKES_loop.gif"></td>
              <td width="50%"><img src="https://radar.weather.gov/ridge/standard/KIND_loop.gif" alt="map"></td>
            </tr><tr>
              <td width="50%" valign="top"><center><img src="https://media.psg.nexstardigital.net/wavy/weather/_National_satrad.gif?w=640"></center></td>
              <td width="50%" valign="top"><center><img src="https://s.w-x.co/util/image/map/WEB_48hour_rain_snow_1280x720.jpg?crop=16:9&width=980&format=pjpg&auto=webp&quality=60" alt="map"></center></td>
            </tr><tr>
	      <td width="50%" valign="top"><center><img src="https://www.cpc.ncep.noaa.gov/products/predictions/814day/814temp.new.gif" alt="map"></center></td>
              <td width="50%" valign="top"><center><img src="https://www.cpc.ncep.noaa.gov/products/predictions/814day/814prcp.new.gif" alt="map"></center></td>
              <!--<td width="50%" valign="top"><center><img src="images/CPC_30_DAY_PRECIP_1280x720.jpg" alt="map"></center></td>-->
              <!--<td width="50%" valign="top"><center><img src="images/CPC_90_DAY_PRECIP_1280x720.jpg" alt="map"></center></td>-->
            </tr><tr>
              <td width="50%" valign="top"><center><img src="https://www.cpc.ncep.noaa.gov/products/expert_assessment/sdohomeweb.png" alt="map"></center></td>
	      <td width="50%" valign="top"><center></center></td>
            </tr><tr>
              <td width="50%" valign="top"><center><img src="https://s.w-x.co/staticmaps/acttemp_1280x720.jpg?crop=16:9&width=800&format=pjpg&auto=webp&quality=60" alt="map"></center></td>
              <td width="50%" valign="top"><center><img src="https://s.w-x.co/staticmaps/us_wxlo1_1280x720.jpg?crop=16:9&width=800&format=pjpg&auto=webp&quality=60" alt="map"></center></td>
            </tr>
          </tbody></table>
        </div>
		</center>
	
    <script src="images/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		window.onload = function() {

            //Get 15 day forecast
            $.getJSON( "https://api.weather.com/v3/wx/forecast/hourly/15day?apiKey=e1f10a1e78da46f5b10a1e78da96f525&geocode=39.3,-85.222&units=e&language=en-US&format=json", {})
            .done(function( data ) {

                /* Wunderground APIs
                    https://api.weather.com/v2/pws/observations/current?apiKey=e1f10a1e78da46f5b10a1e78da96f525&units=e&stationId=KINBATES5&format=json

                    https://api.weather.com/v3/dateTime?apiKey=e1f10a1e78da46f5b10a1e78da96f525&geocode=39.3,-85.222&format=json

                    https://api.weather.com/v3/wx/observations/current?apiKey=e1f10a1e78da46f5b10a1e78da96f525&geocode=39.3,-85.222&units=e&language=en-US&format=json

                    https://api.weather.com/v3/wx/forecast/hourly/15day?apiKey=e1f10a1e78da46f5b10a1e78da96f525&geocode=39.3,-85.222&units=e&language=en-US&format=json
                    
                    https://api.weather.com/v3/wx/observations/current?apiKey=e1f10a1e78da46f5b10a1e78da96f525&geocode=39.3,-85.222&language=en-US&units=e&format=json

                    https://api.weather.com/v3/wx/almanac/daily/5day?apiKey=e1f10a1e78da46f5b10a1e78da96f525&icaoCode=KCVG&units=e&startMonth=07&startDay=13&format=json

                    https://api.weather.com/v3/wx/conditions/historical/dailysummary/30day?apiKey=e1f10a1e78da46f5b10a1e78da96f525&icaoCode=KCVG&units=e&language=EN&format=json

                    https://api.weather.com/v2/astro?apiKey=e1f10a1e78da46f5b10a1e78da96f525&geocode=39.3,-85.222&days=10&date=20220713&format=json


                    https://radblast-aws.wunderground.com/cgi-bin/radar/WUNIDS_map?station=IND&brand=wui&num=10&delay=15&type=N0R&frame=0&scale=1.000&noclutter=0&t=1368730983&lat=0&lon=0&label=you&showstorms=0&map.x=400&map.y=240&centerx=400&centery=240&transx=0&transy=0&showlabels=1&severe=0&rainsnow=0&lightning=0&smooth=0
                    http://radblast-aws.wunderground.com/cgi-bin/radar/WUNIDS_map?station=MKX&brand=wui&num=1&delay=15&type=N0R&frame=0&scale=1.000&noclutter=0&t=1361251226&lat=43.07297897&lon=-89.38169861&label=Madison%2C+WI&showstorms=0&map.x=400&map.y=240&centerx=400&centery=240&transx=0&transy=0&showlabels=1&severe=0&rainsnow=0&lightning=0&smooth=0
                */


                //console.log(data);
                //console.log(data.dayOfWeek);
                //console.log(data.temperature);

                // Daily Data
                var d = [];
                d.date = [];
                d.dayOfWeek = [];
                d.icon = [];
                d.precip_chance = [];
                d.temp_max = [];
                d.temp_min = [];
                d.wind_max = [];

                var dayOfWeek = 1;
                var dayOfWeekStr = "day_" + dayOfWeek;

                d.date[dayOfWeekStr] = parseInt(data.validTimeLocal[0].substring(5,7)) + "/" + parseInt(data.validTimeLocal[0].substring(8,10));
                d.dayOfWeek[dayOfWeekStr] = data.dayOfWeek[0];
                d.icon[dayOfWeekStr] = data.iconCode[0];
                d.precip_chance[dayOfWeekStr] = data.precipChance[0];
                d.temp_max[dayOfWeekStr] = data.temperature[0];
                d.temp_min[dayOfWeekStr] = data.temperature[0];
                d.wind_max[dayOfWeekStr] = data.windSpeed[0];              
                $.each( data.dayOfWeek, function( i, item ) {
                    //console.log("i: " + i);
		    let flag_rain = false;
		    let flag_storm = false;
		    let flag_ice = false;
		    let flag_snow = false;
		    let icon = data.iconCode[i];
		    switch(icon){
			    case 3:
			    case 4:
			    case 37:
			    case 38:
			    case 47:
				    flag_rain = true; flag_storm = true; break;		//icon = 4
			    case 5: 
			    case 6:
			    case 7:
			    case 8:
			    case 10:
			    case 17:
			    case 18:
			    case 35:
				    flag_rain = true; flag_snow = true; break;		// icon = 5
			    case 9:
			    case 11:
			    case 12:
			    case 39:
			    case 40:
			    case 45:
				    flag_rain = true; break;				// icon = 12
			    case 13:
			    case 14:
			    case 15:
			    case 16:
			    case 25:
			    case 41:
			    case 42:
			    case 43:
			    case 46:
				    flag_snow = true; break;				// icon = 16
			    default:
		    }
                    console.log("item: " + item)
                    console.log("item.dayOfWeek[i}: " + data.dayOfWeek[i])
                    //console.log("d.dayOfWeek[dayOfWeek]: " + d.dayOfWeek[dayOfWeek])
                    if (d.dayOfWeek[dayOfWeekStr] == item){ //Do not increment dayOfWeek 
                        if (d.icon[dayOfWeekStr] < data.iconCode[i]){ 
                            d.icon[dayOfWeekStr] = data.iconCode[i]
                            //console.log("   setting temp_max = " + data.temperature[i])
                        }
                        if (d.precip_chance[dayOfWeekStr] < data.precipChance[i]){ 
                            d.precip_chance[dayOfWeekStr] = data.precipChance[i]
                            //console.log("   setting temp_max = " + data.temperature[i])
                        }

                        if (d.temp_max[dayOfWeekStr] < data.temperature[i]){ 
                            d.temp_max[dayOfWeekStr] = data.temperature[i]
                            //console.log("   setting temp_max = " + data.temperature[i])
                        }
                        if (d.temp_min[dayOfWeekStr] > data.temperature[i]){
                            d.temp_min[dayOfWeekStr] = data.temperature[i]
                            //console.log("   setting temp_min = " + data.temperature[i])
                        }
                        if (d.wind_max[dayOfWeekStr] < data.windSpeed[i]){ 
                            d.wind_max[dayOfWeekStr] = data.windSpeed[i]
                            //console.log("   setting temp_max = " + data.temperature[i])
                        }
			//Decide what icon to display for the day. This is subjective as most days contain multiple weather types
		        //  * We will need to get a list of all weather types from the wunderground repository: https://www.wunderground.com/static/i/c/v4/34.svg
			//  * We will have to set some flags early to see if there was any rain

			//By default, we will go with value from above. The following are override rules to always recognize precipitation
			if (flag_rain === true){ d.icon[dayOfWeekStr] = 12; }
			if (flag_storm === true){ d.icon[dayOfWeekStr] = 4; }
			if (flag_snow ===  true){ d.icon[dayOfWeekStr] = 16; }
			if (flag_snow ===  true && flag_rain === true){ d.icon[dayOfWeekStr] = 5; }
			if (flag_snow ===  true && flag_storm === true){ d.icon[dayOfWeekStr] = 5; }
			
                    } else { //Increment dayOfWeek
                        //console.log(d);
                        dayOfWeek = dayOfWeek + 1;
                        dayOfWeekStr = "day_" + dayOfWeek;
                        d.date[dayOfWeekStr] = parseInt(data.validTimeLocal[i].substring(5,7)) + "/" + parseInt(data.validTimeLocal[i].substring(8,10));
                        d.dayOfWeek[dayOfWeekStr] = item;
                        d.icon[dayOfWeekStr] = data.iconCode[i];
                        d.precip_chance[dayOfWeekStr] = data.precipChance[i];
                        d.temp_max[dayOfWeekStr] = data.temperature[i];
                        d.temp_min[dayOfWeekStr] = data.temperature[i];
                        d.wind_max[dayOfWeekStr] = data.windSpeed[i];
                        //console.log("   Incrementing dayOfWeek = " + dayOfWeekStr)
                        //console.log("   RESETTING dayOfWeek string = " + d.dayOfWeek[dayOfWeekStr])
                        //console.log("   RESETTING TEMP_MAX = " + d.temp_max[dayOfWeekStr])
                        //console.log("   RESETTING TEMP_MIN = " + d.temp_max[dayOfWeekStr])
                    }
                })

                //console.log("Done with processing all daily data");
                //console.log(d);

                var html = "";
                
                //html += "validTimeLocal: " + data.validTimeLocal[0] + "<p></p>";
                //html += "validTimeLocal: " + data.validTimeLocal[0].substring(0,10) + "<p></p>";
                //html += "month: " + parseInt(data.validTimeLocal[0].substring(5,7)) + "<p></p>";
                //html += "day: " + parseInt(data.validTimeLocal[0].substring(8,10)) + "<p></p>";
                //html += "day: " + parseInt(data.validTimeLocal[0].substring(5,7)) + "/" + parseInt(data.validTimeLocal[0].substring(8,10)) + "<p></p>";
                //html += "Month: " + Date.parse(data.validTimeLocal[0].substring(0,10)).format("MM/DD") + "<p></p>";
                //.format("MM/DD")
                
                // Hourly Data
                html += "<table border=0 cellpadding=0 cellspacing=0 class='tbl tbl_daily'>"
                html += "<tr><td colspan=16 class='header'><center>15 Day Forecast</center></td></tr>"
                var date_line = "";
                var day_line = "";
                var icon_line = "";
                var precip_line = "";
                var temp_max_line = "";
                var temp_min_line = "";
                var wind_max_line = "";
                for(var i=1; i<dayOfWeek; i++){
                    date_line += "<td class='row_title'>" + d.date["day_" + i] + "</td>";
                    day_line += "<td class='row_title'>" + d.dayOfWeek["day_" + i].substring(0,3) + "</td>";
                    icon_line += "<td class='icon'>" + "<img src='https://www.wunderground.com/static/i/c/v4/" + d.icon["day_" + i] + ".svg' width='35' ></td>";
                    precip_line += "<td class='row_title'>" + d.precip_chance["day_" + i] + "%</td>";
                    temp_max_line += "<td>" + d.temp_max["day_" + i]+ "</td>"
                    temp_min_line += "<td>" + d.temp_min["day_" + i]+ "</td>"
                    wind_max_line += "<td>" + d.wind_max["day_" + i]+ "</td>"
                }

                html += "<tr><td class='row_title'></td>" + day_line + "<tr>";
                html += "<tr><td class='row_title'></td>" + date_line + "<tr>";
                html += "<tr><td class='row_title'>High</td>" + temp_max_line + "<tr>";
                html += "<tr><td class='row_title'>Low</td>" + temp_min_line + "<tr>";
                html += "<tr><td class='row_title'>Wind</td>" + wind_max_line + "<tr>";
                html += "<tr><td class='row_title'>Precip</td>" + precip_line + "<tr>";
                html += "<tr><td class='row_title'></td>" + icon_line + "<tr>";
                html += "</table>"
                
                html += "<table border=0 cellpadding=0 cellspacing=0 class='tbl tbl_hourly'>"
                html += "<tr><td colspan=25 class='header'><center>24 Hour Forecast</center></td></tr>"
                icon_line = "";
                var temp_line = "";
                var time_line = "";
                var t = 0;
                var t_str = "";
                for(var i=0; i<24; i++){
                    icon_line += "<td class='icon'>" + "<img src='https://www.wunderground.com/static/i/c/v4/" + data.iconCode[i] + ".svg' width='25' ></td>";
                    t = parseInt(data.validTimeLocal[i].substring(11,16));
                    if (t < 12){ t_str = t + "am"; }
                    if (t > 12){ t_str = (t - 12) + "pm"; }
                    if (t == 0){ t_str = "mid"; }
                    if (t == 12){ t_str = "noon"; }
                    time_line += "<td class='row_title'>" + t_str + "</td>";
                    temp_line += "<td class='row_title'>" + data.temperature[i] + "</td>";
                }
                
                html += "<tr><td class='row_title'></td>" + time_line + "<tr>";
                html += "<tr><td class='row_title'>Temp</td>" + temp_line + "<tr>";
                html += "<tr><td class='row_title'></td>" + icon_line + "<tr>";
                
                $("#div_daily_table").html(html);
                //console.log(html);
            })

        }

	</script>
  <!--
       Good places to start looking for new maps:
       * https://weather.com/maps/tendayforecast
       * https://weather.com/maps/ustemperaturemap
       
      

  -->

</body></html>
